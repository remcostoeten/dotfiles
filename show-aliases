#!/usr/bin/env bash

# Show aliases in the same format as the interactive browser
DOTFILES_ROOT="${DOTFILES_ROOT:-$HOME/.config/dotfiles}"

# Load aliases from dotfiles
declare -A ALIASES=()
declare -A ALIAS_DESCRIPTIONS=()
declare -A ALIAS_CATEGORIES=()

function load_aliases() {
    local aliases_dir="$DOTFILES_ROOT/modules/aliases"
    [[ ! -d "$aliases_dir" ]] && return
    
    for file in "$aliases_dir"/*.aliases; do
        [[ ! -f "$file" ]] && continue
        
        local category=$(basename "$file" .aliases)
        
        while IFS= read -r line || [[ -n "$line" ]]; do
            # Skip empty lines and comments
            [[ -z "$line" || "$line" =~ ^[[:space:]]*# ]] && continue
            
            # Parse alias lines
            if [[ "$line" =~ ^[[:space:]]*alias[[:space:]]+([^=]+)=(.+)$ ]]; then
                local alias_name="${BASH_REMATCH[1]// /}"
                local alias_command="${BASH_REMATCH[2]}"
                
                # Clean up command (remove quotes)
                alias_command="${alias_command#\"}"
                alias_command="${alias_command%\"}"
                alias_command="${alias_command#\'}"
                alias_command="${alias_command%\'}"
                
                # Store alias info
                ALIASES["$alias_name"]="$alias_command"
                ALIAS_DESCRIPTIONS["$alias_name"]="Executes: $alias_command"
                ALIAS_CATEGORIES["$alias_name"]="$category"
            fi
        done < "$file"
    done
}

load_aliases

# Count unique categories
declare -A unique_categories=()
for alias_name in "${!ALIASES[@]}"; do
    unique_categories["${ALIAS_CATEGORIES[$alias_name]}"]="1"
done

# Show header
echo -e "\n\033[1;38;5;39mâ•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®\033[0m"
echo -e "\033[1;38;5;39mâ”‚\033[0m \033[1;38;5;226mðŸš€ Available Aliases (Interactive Preview)\033[0m         \033[1;38;5;39mâ”‚\033[0m"
echo -e "\033[1;38;5;39mâ”‚\033[0m \033[0;38;5;242m${#ALIASES[@]} aliases across ${#unique_categories[@]} categories\033[0m                        \033[1;38;5;39mâ”‚\033[0m"
echo -e "\033[1;38;5;39mâ•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯\033[0m"
echo

# Generate formatted list
for alias_name in "${!ALIASES[@]}"; do
    cmd="${ALIASES[$alias_name]}"
    desc="${ALIAS_DESCRIPTIONS[$alias_name]}"
    cat="${ALIAS_CATEGORIES[$alias_name]}"
    
    # Get icon for category
    icon=""
    case "$cat" in
        "git") icon="ðŸ™" ;;
        "dev") icon="âš™ï¸" ;;
        "general") icon="ðŸ“¦" ;;
        "dotfiles") icon="ðŸ " ;;
        "drizzle") icon="ðŸ—„ï¸" ;;
        "help") icon="â“" ;;
        "zoxide") icon="ðŸ“" ;;
        *) icon="ðŸ“‹" ;;
    esac
    
    # Truncate long commands for display
    display_cmd="$cmd"
    if [[ ${#cmd} -gt 40 ]]; then
        display_cmd="${cmd:0:37}..."
    fi
    
    # Create display line with colors
    printf "\033[1;36m%-12s\033[0m %s \033[0;35m%-10s\033[0m â†’ \033[1;33m%-40s\033[0m \033[0;37m%s\033[0m\n" \
        "$alias_name" \
        "$icon" \
        "[$cat]" \
        "$display_cmd" \
        "${desc#Executes: }"
done | sort

echo
echo -e "\033[0;38;5;117mðŸ’¡ Run \033[1;38;5;228mhelp -i\033[0m\033[0;38;5;117m for interactive fuzzy search\033[0m"
echo -e "\033[0;38;5;117mðŸ’¡ Run \033[1;38;5;228mhelp <alias_name>\033[0m\033[0;38;5;117m for specific alias details\033[0m"
echo
