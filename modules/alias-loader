#!/usr/bin/env bash

function load_aliases() {
    local alias_dir="$DOTFILES_MODULES/aliases"
    
    if [[ ! -d "$alias_dir" ]]; then
        echo.debug "No alias directory found at $alias_dir"
        return 0
    fi
    
    echo.debug "Loading aliases..."
    
    local count=0
    local failed=0
    
    for alias_file in "$alias_dir"/*.aliases; do
        [[ ! -f "$alias_file" ]] && continue
        
        local filename=$(basename "$alias_file")
        
        if [[ "$filename" == *.disabled ]]; then
            echo.debug "  ⊗ $filename (disabled)"
            continue
        fi
        
        count=$((count + 1))
        
        if safe_source "$alias_file"; then
            echo.debug "  ✓ $filename"
        else
            failed=$((failed + 1))
            echo.error "  ✗ Failed to load $filename"
        fi
    done
    
    if [[ $count -gt 0 ]]; then
        echo.debug "Loaded $((count - failed))/$count alias files"
    fi
}

function help() {
    if [[ -z "$1" ]]; then
        echo "Available commands:"
        for file in "$DOTFILES_MODULES"/aliases/*.aliases; do
            [[ ! -f "$file" ]] && continue
            echo "--- $(basename "$file" .aliases) ---"
            grep -E '^# @alias' "$file" 2>/dev/null | sed -e 's/# @alias //' -e 's/# @desc /\t/' || true
        done
    else
        for file in "$DOTFILES_MODULES"/aliases/*.aliases; do
            [[ ! -f "$file" ]] && continue
            if grep -q "# @alias $1" "$file" 2>/dev/null; then
                grep -A 1 "# @alias $1" "$file" 2>/dev/null | sed -e 's/# @alias //' -e 's/# @desc /\t/' || true
                return
            fi
        done
        echo "Alias not found: $1"
    fi
}

alias help=help

load_aliases
