#!/usr/bin/env zsh

# Demo of Enhanced Interactive Prompt Builder
# Shows the key features without requiring full interaction

source "${HOME}/.config/dotfiles/core/_env"
source "${HOME}/.config/dotfiles/core/_colors"
source "${HOME}/.config/dotfiles/core/_safety"
source "${HOME}/.config/dotfiles/modules/enabled/prompt-template"

function demo_layout() {
    echo.header "üé® Enhanced Interactive Prompt Builder Demo"
    echo.info "Your terminal: ${COLUMNS}√ó${LINES} (${TERM})"
    echo
    
    # Demo layout calculation
    setup_split_layout
    
    echo.success "Split Layout Configuration:"
    echo.cyan "‚Ä¢ Total columns: $LAYOUT_TOTAL_COLS"
    echo.cyan "‚Ä¢ Left panel: $LAYOUT_LEFT_COLS columns"
    echo.cyan "‚Ä¢ Right panel: $LAYOUT_RIGHT_COLS columns"
    echo.cyan "‚Ä¢ Divider at: $LAYOUT_DIVIDER_COL"
    echo
    
    if [[ $LAYOUT_TOTAL_COLS -lt 100 ]]; then
        echo.warning "‚ö†Ô∏è  Terminal too narrow for split view"
        echo.info "Would fall back to simple mode"
    else
        echo.success "‚úÖ Terminal is wide enough for split view"
        echo.info "Enhanced sidebar mode available"
    fi
    echo
}

function demo_sidebar_preview() {
    echo.header "üìä Sidebar Preview Simulation"
    echo
    
    # Extract template variables for demo
    local variables=($(echo "$PROMPT_TEMPLATE_CONTENT" | grep -oE '\\{\\{[^}]+\\}\\}' | sort -u))
    
    echo.cyan "Template variables found: ${#variables[@]}"
    local i=1
    for var in "${variables[@]:0:5}"; do  # Show first 5
        local clean_var=$(echo "$var" | sed 's/[{}]//g')
        if [[ $i -le 2 ]]; then
            echo.success "‚úì $i. $clean_var (filled)"
        elif [[ $i -eq 3 ]]; then
            echo.warning "‚û§ $i. $clean_var (current)"
        else
            echo.info "  $i. $clean_var (pending)"
        fi
        ((i++))
    done
    
    echo
    echo.purple "Live Preview Features:"
    echo "‚Ä¢ Real-time updates as you type"
    echo "‚Ä¢ Color-coded variable states"
    echo "‚Ä¢ Progress tracking"
    echo "‚Ä¢ Context-aware scrolling"
    echo
}

function demo_features() {
    echo.header "‚ú® Key Features"
    echo
    
    echo.purple "üéØ Split-Screen Interface:"
    echo "‚Ä¢ Left panel: Current step & input"
    echo "‚Ä¢ Right panel: Live preview sidebar"
    echo "‚Ä¢ Vertical divider with box drawing chars"
    echo
    
    echo.purple "üé® Visual Enhancements:"
    echo "‚Ä¢ $(echo.success 'Green') for completed variables"
    echo "‚Ä¢ $(echo.warning 'Yellow') for current variable"
    echo "‚Ä¢ $(echo.info 'Dim gray') for pending variables"
    echo "‚Ä¢ Progress indicators and step counters"
    echo
    
    echo.purple "‚å®Ô∏è  Navigation:"
    echo "‚Ä¢ [Enter] Continue to next variable"
    echo "‚Ä¢ [t] Show full template overlay"
    echo "‚Ä¢ [b] Go back to previous variable"
    echo "‚Ä¢ [s] Skip to end and save"
    echo "‚Ä¢ [q] Quit without saving"
    echo
    
    echo.purple "üîÑ Responsive Design:"
    echo "‚Ä¢ Auto-detects terminal width"
    echo "‚Ä¢ Falls back to simple mode if < 100 columns"
    echo "‚Ä¢ Handles terminal resizing gracefully"
    echo
    
    echo.purple "üíæ Backup & Recovery:"
    echo "‚Ä¢ Auto-saves after each step"
    echo "‚Ä¢ Persistent backup directory"
    echo "‚Ä¢ Recovery from interrupted sessions"
    echo
}

function demo_usage() {
    echo.header "üöÄ Usage Examples"
    echo
    
    echo.cyan "Basic usage:"
    echo.success "  prompt interactive"
    echo.success "  prompt i"
    echo
    
    echo.cyan "Other commands:"
    echo.success "  prompt              # View template"
    echo.success "  prompt copy         # Copy to clipboard"
    echo.success "  prompt help         # Show help"
    echo
    
    echo.info "üí° Tip: Try 'prompt i' to see the full interactive experience!"
    echo
}

# Main demo
case "${1:-all}" in
    "layout"|"l")
        demo_layout
        ;;
    "sidebar"|"s")
        demo_sidebar_preview
        ;;
    "features"|"f")
        demo_features
        ;;
    "usage"|"u")
        demo_usage
        ;;
    "all"|"")
        demo_layout
        echo
        demo_sidebar_preview
        echo
        demo_features
        echo
        demo_usage
        ;;
    *)
        echo.error "Unknown demo: $1"
        echo.info "Available demos: layout, sidebar, features, usage, all"
        exit 1
        ;;
esac
