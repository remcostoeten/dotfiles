#!/usr/bin/env bash

# Environment change hook - triggers sync operations
ENV_CHANGE_MARKER="$DOTFILES_UTILS/.env-changed"
SYNC_DEBOUNCE_DELAY=3

function trigger_sync() {
    if [[ "${DOTFILES_AUTO_SYNC:-0}" == "1" ]]; then
        # Create change marker
        touch "$ENV_CHANGE_MARKER"
        
        # Debounced sync - only sync after delay with no new changes
        (
            sleep $SYNC_DEBOUNCE_DELAY
            if [[ -f "$ENV_CHANGE_MARKER" ]]; then
                rm -f "$ENV_CHANGE_MARKER"
                echo "ðŸ”„ Auto-syncing environment changes..."
                if command -v dotfiles &>/dev/null; then
                    dotfiles sync push >/dev/null 2>&1 &
                fi
            fi
        ) &
    fi
}

trigger_sync
