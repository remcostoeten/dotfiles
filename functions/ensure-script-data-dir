# DOCSTRING: Ensure script data directory exists and return its path
# Usage: ensure-script-data-dir <script-name> [subpath]

# Default storage root: $HOME/.dotfiles (override with DOTFILES_DATA_DIR)

ensure-script-data-dir() {
    local script_name="${1:-}"
    local subpath="${2:-}"

    if [ -z "$script_name" ]; then
        echo "Error: Script name required" >&2
        echo "Usage: ensure-script-data-dir <script-name> [subpath]" >&2
        return 1
    fi

    if ! command -v get-script-data-dir >/dev/null 2>&1; then
        echo "Error: get-script-data-dir function is required" >&2
        return 1
    fi

    local base_dir
    base_dir="$(get-script-data-dir "$script_name")" || return 1

    local target_dir="$base_dir"
    if [ -n "$subpath" ]; then
        target_dir="$base_dir/$subpath"
    fi

    mkdir -p "$target_dir" || return 1
    echo "$target_dir"
}

# Helper to build file path inside script data directory
# Usage: script-data-file <script-name> <relative-path>
script-data-file() {
    local script_name="${1:-}"
    local relative_path="${2:-}"

    if [ -z "$script_name" ] || [ -z "$relative_path" ]; then
        echo "Error: script-data-file requires <script-name> and <relative-path>" >&2
        return 1
    fi

    local dir
    dir="$(ensure-script-data-dir "$script_name")" || return 1
    echo "$dir/$relative_path"
}


